<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kasir Konterpedia</title>
<style>
body{margin:0;font-family:system-ui,sans-serif;background:#f4f6f8;}
header{background:#0d6efd;color:#fff;padding:14px;text-align:center;font-size:18px;font-weight:700;}
.menu{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:12px;}
.menu .card{background:#fff;border-radius:12px;padding:12px 5px;text-align:center;font-size:13px;font-weight:600;box-shadow:0 2px 6px rgba(0,0,0,.1);}
.menu .active{background:#0d6efd;color:#fff;}
.form{background:#fff;margin:12px;padding:15px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.1);animation:fade .2s ease;}
.form input, .form select{width:100%;padding:10px;margin-bottom:10px;border-radius:8px;border:1px solid #ccc;}
.form button{width:100%;padding:12px;background:#0d6efd;color:#fff;border:none;border-radius:10px;font-weight:700;transition:transform .1s ease;}
.form button:active{transform:scale(.97);}
@keyframes fade{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:none;}}
.laporan-wrap{padding:12px;}
.laporan-total{background:linear-gradient(135deg,#0d6efd,#4dabf7);color:#fff;padding:18px;border-radius:16px;margin-bottom:12px;}
.laporan-total small{opacity:.9;}
.laporan-total h1{margin:6px 0 0;font-size:28px;}
.laporan-list{background:#fff;border-radius:14px;overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,.08);}
.laporan-item{display:flex;justify-content:space-between;padding:12px 14px;border-bottom:1px solid #eee;}
.laporan-item:last-child{border-bottom:none;}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:#fff;display:flex;border-top:1px solid #ddd;}
.bottom-nav div{flex:1;text-align:center;padding:10px 0;font-size:13px;transition:transform .1s ease;}
.bottom-nav div:active{transform:scale(.96);}
body{padding-bottom:60px;}
</style>
</head>
<body>

<header>Kasir Konterpedia</header>

<div class="menu">
  <div class="card active" onclick="showForm('transaksi',this)">Transaksi</div>
  <div class="card" onclick="showForm('produk',this)">Produk</div>
  <div class="card" onclick="showForm('laporan',this)">Laporan</div>
</div>

<div class="form" id="formTransaksi">
  <h3>Transaksi</h3>
  <label>Kategori</label>
  <select id="kategori" onchange="updateProduk()">
    <option value="">-- Pilih Kategori --</option>
  </select>
  <label>Produk</label>
  <select id="produk" onchange="isiHarga()">
    <option value="">-- Pilih Produk --</option>
  </select>
  <label>Nominal</label>
  <input type="number" id="nominal" readonly>
  <label>Modal</label>
  <input type="number" id="modal" readonly>
  <label>Untung</label>
  <input type="number" id="untung">
  <button onclick="simpanTransaksi()">Simpan</button>
</div>

<div class="form" id="formProduk" style="display:none">
  <h3>Kelola Produk</h3>
  <label>Kategori</label>
  <select id="kategoriBaru">
    <option value="">-- Pilih Kategori --</option>
    <option>Pulsa</option>
    <option>E-Wallet</option>
    <option>Token PLN</option>
  </select>
  <label>Nama Produk</label>
  <input type="text" id="namaProduk">
  <label>Nominal</label>
  <input type="number" id="nominalProduk">
  <label>Modal</label>
  <input type="number" id="modalProduk">
  <button onclick="tambahProduk()">Simpan Produk</button>
  <div id="notifProduk"></div>
</div>

<div class="form" id="formLaporan" style="display:none">
  <h3>Laporan</h3>
  <div id="isiLaporan"><i>Laporan akan muncul di sini</i></div>
  <button onclick="refreshLaporan()">Refresh</button>
</div>

<div class="bottom-nav">
  <div onclick="showForm('transaksi',this)">üè†<br>Kasir</div>
  <div onclick="showForm('produk',this)">üõ†<br>Produk</div>
  <div onclick="showForm('laporan',this)">üìä<br>Laporan</div>
</div>

<script>
function showForm(id,el){
  document.querySelectorAll('.menu .card').forEach(c=>c.classList.remove('active'));
  if(el) el.classList.add('active');
  document.getElementById('formTransaksi').style.display='none';
  document.getElementById('formProduk').style.display='none';
  document.getElementById('formLaporan').style.display='none';
  if(id==='transaksi') document.getElementById('formTransaksi').style.display='block';
  if(id==='produk') document.getElementById('formProduk').style.display='block';
  if(id==='laporan') document.getElementById('formLaporan').style.display='block';
}

// TRANSAKSI
function updateProduk(){
  const kategori = document.getElementById("kategori").value;
  const produk = document.getElementById("produk");
  produk.innerHTML = '<option value="">-- Pilih Produk --</option>';
  document.getElementById("nominal").value="";
  document.getElementById("modal").value="";
  document.getElementById("untung").value="";

  if(!kategori) return;

  google.script.run.withSuccessHandler(function(data){
    data.filter(p=>p[0]===kategori).forEach((p,i)=>{
      produk.innerHTML += `<option value="${i}" data-nominal="${p[2]}" data-modal="${p[3]}">${p[1]}</option>`;
    });
  }).getProduk();
}

function isiHarga(){
  const produkEl = document.getElementById("produk");
  const selected = produkEl.options[produkEl.selectedIndex];
  if(!selected || selected.value==="") return;
  document.getElementById("nominal").value = selected.dataset.nominal;
  document.getElementById("modal").value = selected.dataset.modal;
  document.getElementById("untung").value = selected.dataset.nominal - selected.dataset.modal;
}

function simpanTransaksi(){
  const data = {
    kategori: document.getElementById("kategori").value,
    produk: document.getElementById("produk").selectedOptions[0].text,
    nominal: Number(document.getElementById("nominal").value),
    modal: Number(document.getElementById("modal").value),
    untung: Number(document.getElementById("untung").value)
  };
  google.script.run.withSuccessHandler(function(){
    alert("Transaksi tersimpan ‚úî");
    document.getElementById("kategori").value="";
    document.getElementById("produk").innerHTML = '<option value="">-- Pilih Produk --</option>';
    document.getElementById("nominal").value="";
    document.getElementById("modal").value="";
    document.getElementById("untung").value="";
  }).simpanTransaksi(data);
}

// PRODUK
function tambahProduk(){
  const kategori = document.getElementById("kategoriBaru").value;
  const nama = document.getElementById("namaProduk").value;
  const nominal = Number(document.getElementById("nominalProduk").value);
  const modal = Number(document.getElementById("modalProduk").value);

  if(!kategori || !nama || !nominal || !modal){
    alert("Lengkapi data produk!");
    return;
  }

  google.script.run.withSuccessHandler(function(){
    document.getElementById("namaProduk").value="";
    document.getElementById("nominalProduk").value="";
    document.getElementById("modalProduk").value="";
    document.getElementById("notifProduk").innerHTML="Produk berhasil ditambahkan ‚úî";
    updateProduk();
  }).tambahProduk(kategori,nama,nominal,modal);
}

// LAPORAN
function refreshLaporan(){
  google.script.run.withSuccessHandler(function(data){
    if(data.length<=1){
      document.getElementById("isiLaporan").innerHTML="<i>Tidak ada transaksi</i>";
      return;
    }
    let html = '<div class="laporan-wrap"><div class="laporan-total"><small>Total Untung</small><h1>';
    const total = data.slice(1).reduce((acc,row)=>acc + Number(row[5]),0);
    html += total + '</h1></div>';
    html += '<div class="laporan-list">';
    data.slice(1).forEach(row=>{
      html += `<div class="laporan-item"><b>${row[2]}</b><span>Rp ${row[5]}</span></div>`;
    });
    html += '</div></div>';
    document.getElementById("isiLaporan").innerHTML = html;
  }).getTransaksi();
}
</script>

</body>
</html>
