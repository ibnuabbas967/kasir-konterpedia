<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kasir Konterpedia</title>

<style>
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:#f4f6f8;
}
header{
  background:#0d6efd;
  color:#fff;
  padding:14px;
  text-align:center;
  font-size:18px;
  font-weight:700;
}
.menu{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
  padding:12px;
}
.menu .card{
  background:#fff;
  border-radius:12px;
  padding:12px 5px;
  text-align:center;
  font-size:13px;
  font-weight:600;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}
.menu .active{
  background:#0d6efd;
  color:#fff;
}
.form{
  background:#fff;
  margin:12px;
  padding:15px;
  border-radius:12px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}
.form input{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:8px;
  border:1px solid #ccc;
}
.form button{
  width:100%;
  padding:12px;
  background:#0d6efd;
  color:#fff;
  border:none;
  border-radius:10px;
  font-weight:700;
}
.item{
  border-bottom:1px solid #eee;
  padding:6px 0;
}
</style>
</head>

<body>

<header>Kasir Konterpedia</header>

<!-- MENU -->
<div class="menu">
  <div class="card active" onclick="bukaTransaksi('Pulsa',this)">Pulsa</div>
  <div class="card" onclick="bukaTransaksi('Token PLN',this)">Token PLN</div>
  <div class="card" onclick="bukaTransaksi('E-Wallet',this)">E-Wallet</div>
  <div class="card" onclick="bukaLaporan(this)">Laporan</div>
</div>

<!-- FORM TRANSAKSI -->
<div class="form" id="formTransaksi">
  <h3 id="judul">Input Pulsa</h3>
  <input id="produk" placeholder="Nama Produk">
  <input id="modal" type="number" placeholder="Modal">
  <input id="harga" type="number" placeholder="Harga Jual">
  <button onclick="simpan()">Simpan Transaksi</button>
</div>

<!-- LAPORAN -->
<div class="form" id="formLaporan" style="display:none">
  <h3>Laporan Transaksi</h3>
  <div id="isiLaporan">Loading...</div>
</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbwShdpVDF7Yjx8Sk7g7GYKsnMz1ps-RS5DdzPoOlBuQJsyKrdfzL3ahobbwfwPGOpyY/exec";
let jenisAktif = "Pulsa";

/* MENU TRANSAKSI */
function bukaTransaksi(jenis,el){
  jenisAktif = jenis;
  document.getElementById('judul').innerText = "Input " + jenis;
  document.getElementById('formTransaksi').style.display="block";
  document.getElementById('formLaporan').style.display="none";
  aktifkan(el);
}

/* MENU LAPORAN */
function bukaLaporan(el){
  document.getElementById('formTransaksi').style.display="none";
  document.getElementById('formLaporan').style.display="block";
  aktifkan(el);

  isiLaporan.innerHTML = "Memuat data...";

  fetch(GAS_URL)
    .then(r => r.json())
    .then(data => {
      if(!Array.isArray(data) || data.length === 0){
        isiLaporan.innerHTML = 
          "<i>Belum ada data laporan.</i>";
        return;
      }

      let html="";
      let total=0;

      data.forEach(d=>{
        html += `
          <div class="item">
            <b>${d[2]}</b><br>
            ${d[1]} | Untung: Rp ${d[5]}
          </div>`;
        total += Number(d[5]);
      });

      isiLaporan.innerHTML =
        html + `<hr><b>Total Untung: Rp ${total}</b>`;
    })
    .catch(()=>{
      isiLaporan.innerHTML = 
        "<i>Laporan belum aktif. Nyalakan backend saat listrik normal.</i>";
    });
}

/* SIMPAN TRANSAKSI */
function simpan(){
  if(!produk.value || !modal.value || !harga.value){
    alert("Lengkapi data");
    return;
  }

  fetch(GAS_URL,{
    method:"POST",
    body:JSON.stringify({
      jenis: jenisAktif,
      produk: produk.value,
      modal: Number(modal.value),
      harga: Number(harga.value),
      untung: harga.value - modal.value
    })
  }).then(()=>{
    alert("Transaksi tersimpan");
    produk.value="";
    modal.value="";
    harga.value="";
  });
}

/* AKTIFKAN MENU */
function aktifkan(el){
  document.querySelectorAll('.menu .card')
    .forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
}
</script>

</body>
</html>
